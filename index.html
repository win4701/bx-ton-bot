<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width"/>
<title>Bloxio</title>
<style>
body{margin:0;background:#070a14;color:#e5e7eb;font-family:system-ui}
header{padding:14px;font-weight:900}
.card{background:#0b1020;margin:10px;padding:12px;border-radius:12px}
button{width:100%;padding:12px;margin-top:6px;border:0;border-radius:10px;font-weight:800}
.primary{background:#facc15;color:#020617}
small{color:#9ca3af}
</style>
</head>
<body>
<header>BX â€” Bloxio</header>

<div class="card">
<h3>ðŸ“Š Market</h3>
<div id="ticker"></div>
</div>

<div class="card">
<h3>ðŸŽ° Casino</h3>
<button onclick="crash()">Crash</button>
<button onclick="dice()">Dice</button>
</div>

<div class="card">
<h3>ðŸ’° Wallet</h3>
<div id="bal"></div>
<button class="primary" onclick="buyTon()">Buy BX (TON)</button>
<button onclick="withdraw()">Withdraw TON</button>
</div>

<div class="card">
<h3>ðŸ›  Admin</h3>
<button onclick="admin()">Load Pending</button>
<pre id="adm"></pre>
</div>

<script>
const tg=window.Telegram?.WebApp; if(tg){tg.ready();tg.expand();}
const uid=tg?.initDataUnsafe?.user?.id||0;

async function init(){
 await fetch('/user/init',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:uid})});
 loadMarket(); loadBal();
}
async function loadMarket(){
 const d=await (await fetch('/market')).json();
 ticker.textContent=`BX/TON ${d.bx_ton} | BX/USDT ${d.bx_usdt} | Vol ${d.vol}`;
}
setInterval(loadMarket,30000);

async function loadBal(){
 const d=await (await fetch(`/wallet/${uid}`)).json();
 bal.textContent=`BX Balance: ${d.bx}`;
}

async function crash(){
 alert(JSON.stringify(await (await fetch(`/casino/crash?uid=${uid}`)).json()));
}
async function dice(){
 alert(JSON.stringify(await (await fetch('/casino/dice',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:uid})})).json()));
}
async function buyTon(){
 const ton=prompt("TON amount");
 alert(JSON.stringify(await (await fetch('/buy/ton',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:uid,ton:parseFloat(ton)})})).json()));
 loadBal();
}
async function withdraw(){
 const ton=prompt("TON amount");
 const addr=prompt("TON address");
 alert(JSON.stringify(await (await fetch('/withdraw/ton',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:uid,ton:parseFloat(ton),address:addr})})).json()));
}
async function admin(){
 const a=prompt("Admin ID");
 const d=await (await fetch(`/admin/pending?admin=${a}`)).json();
 adm.textContent=JSON.stringify(d,null,2);
}
init();
</script>
</body>
</html>
